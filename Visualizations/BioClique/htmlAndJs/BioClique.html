<!doctype html>
<html>
    <head>
        <title>Ensembl visualization</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="../css/vis-network.min.css" type="text/css" />
        <link rel="stylesheet" href="../css/bootstrap.min.css" type="text/css" />
        <link rel="stylesheet" href="../css/vis-network.min.css" type="text/css" />
        <link rel="stylesheet" href="../css/c3.css" type="text/css" />
        <link rel="stylesheet" href="../css/dc.css" type="text/css" />
        <link rel="stylesheet" href="../css/bootstrap.css" type="text/css" />
        <link rel="stylesheet" href="../css/BioClique.css" type="text/css" />
    </head> 
    <body>
        <script type="text/javascript" src="../js/d3.js"></script>
        <script type="text/javascript" src="../js/crossfilter.js"></script>
        <script type="text/javascript" src="../js/dc.js"></script>
        <script type="text/javascript" src="../js/papaparse.min.js"></script>
        <script type="text/javascript" src="../js/underscore-min.js"></script>
        <script type="text/javascript" src="../js/jquery-3.6.0.min.js"></script>
        <script type="text/javascript" src="../js/vis-network.min.js"></script>

        <script type="text/javascript" src="currentH.js"></script>
        
        
        
        <div style="display:inline-flex" id="readFileBigDiv">
            <div id="selectionDiv"> 
                <div>
                    <input id="readFile" type="file" onchange="read(this)"/>
                </div>  
            </div> 
        </div>
        

        <div id="mynetwork">
            <div id="topSelectInfo" class="three-sides-auto" style="visibility: hidden;">
                <div id="tinyFilters" class="allMyTinyFilters, chart-group">
                    <div id="tissueSelect"></div>
                    <div id="uploadTissues">
                        <input type="button" class="btn btn-light mybtn" value="Load tissue" onclick="uploadSegments()">
                    </div>
                </div>

                <div id="statsDownload" class="chart-group" style="visibility: hidden;">
                    <div id = "mystats" >
                        <span class = "filter-count"></span> selected out of <span
                        class = "total-count"></span> | <a href = "javascript:resetAll();">Reset All</a>
                    </div>
                </div>  
                <div id="downloadCSVBtnDiv" class="chart-group" style="visibility: hidden;">
                    <input type="button" class="btn btn-light mybtn" id="downloadCSVBTN" value="Download CSV" disabled  onclick="downloadCSV()">
                </div>  
            </div>
            
            <div id="allCharts" style="visibility: hidden;">
                
                <div class="main-chart" id="LociDiv"></div>
    
    
                <div class="chart-group">
                    <div id="filter-display"></div>
                    Coordinates : 
                        <input type="text" class="form-control myinput" id="LociDiv_lower-bound" style="width: 120px; text-align: right; " />
                        , <input type="text" class="form-control myinput" id="LociDiv_upper-bound" style="width: 120px; text-align: right; " />
                    &nbsp&nbsp Distance to closest GTEx gene : 
                        <input type="text" class="form-control myinput" id="GTExDistanceDiv_lower-bound" style="width: 90px; text-align: right; " />
                        , <input type="text" class="form-control myinput" id="GTExDistanceDiv_upper-bound" style="width: 90px; text-align: right; " />
                    &nbsp&nbsp Distance to closest FANTOM5 locus : 
                        <input type="text" class="form-control myinput" id="FantomDistanceDiv_lower-bound" style="width: 90px; text-align: right; " />
                        , <input type="text" class="form-control myinput" id="FantomDistanceDiv_upper-bound" style="width: 90px; text-align: right; " />
                    <button id="apply-filter" class="btn btn-light mybtn">Apply Filter</button>
                </div>

                <div id="DistanceDivs" class="two-halves">
                    <div class="main-chart" id="GTExDistanceDiv"></div>
                    <div class="main-chart" id="FantomDistanceDiv"></div>
                </div>
                
                <div class="two-sides">
                    <div class="left-side">
                        <div class="main-chart" id="GTExDiv"></div>
                        <div class="main-chart" id="FantomDiv"></div>
                        <div class="main-chart" id="ECentralityDiv"></div>
                        <div class="main-chart" id="SomaticDiv0"></div>
                        <div class="main-chart" id="SomaticDiv1"></div>
                        <div class="main-chart" id="SomaticDiv2"></div>
                        <div class="main-chart" id="RNApolymeraseDiv"></div>
                    </div>
                    <div class="right-side">
                        <div class="graph-div"> <div id="mygraph"></div></div>
                        
                        <h4 class="chart-title">ChromHMM annotations from Roadmap Epigenomics</h4>
                        <div class="chart-container" id="pieChartsDiv">
                            <div class="chart-groupp" id="sandrasExtraChartsDiv"></div>
                        </div>    
                        
                        <br>
                        <h4 class="chart-title">Features from Ensembl</h4>                    
                        <div class="chart-container">
                            <div class="chart-groupp" id="ens1wr">
                                <div class="single-chart-container extra-chart">
                                    <div class="filtered-pie-chart" id="miRNADivSmall1"></div>
                                    <div class="original-pie-chart" id="miRNADivSmall1-OG"></div>
                                </div>
                            </div>
            
                            <div class="chart-groupp" id="ens2wr">
                                <div class="single-chart-container extra-chart">
                                    <div class="filtered-pie-chart" id="otherFTCDivSmall1"></div>
                                    <div class="original-pie-chart" id="otherFTCDivSmall1-OG"></div>
                                </div>
                                <div class="single-chart-container extra-chart">
                                    <div class="filtered-pie-chart" id="otherFTCDivSmall2"></div>
                                    <div class="original-pie-chart" id="otherFTCDivSmall2-OG"></div>
                                </div>
                            </div>
            
                            <div class="chart-groupp" id="ens3wr">
                                <div class="single-chart-container extra-chart">
                                    <div class="filtered-pie-chart" id="HumanRegFeatDivSmall1"></div>
                                    <div class="original-pie-chart" id="HumanRegFeatDivSmall1-OG"></div>
                                </div>
                                <div class="single-chart-container extra-chart">
                                    <div class="filtered-pie-chart" id="HumanRegFeatDivSmall2"></div>
                                    <div class="original-pie-chart" id="HumanRegFeatDivSmall2-OG"></div>
                                </div>
                                <div class="single-chart-container extra-chart">
                                    <div class="filtered-pie-chart" id="HumanRegFeatDivSmall3"></div>
                                    <div class="original-pie-chart" id="HumanRegFeatDivSmall3-OG"></div>
                                </div>
                                <div class="single-chart-container extra-chart">
                                    <div class="filtered-pie-chart" id="HumanRegFeatDivSmall4"></div>
                                    <div class="original-pie-chart" id="HumanRegFeatDivSmall4-OG"></div>
                                </div>
                                <div class="single-chart-container extra-chart">
                                    <div class="filtered-pie-chart" id="HumanRegFeatDivSmall5"></div>
                                    <div class="original-pie-chart" id="HumanRegFeatDivSmall5-OG"></div>
                                </div>
                            </div>
                        </div>
                        
                        <br>
                        <h4 class="chart-title">Features from ENCODE</h4>
                        <div class="chart-container">
                            <div class="chart-groupp" id="encodeFeaturesDiv"></div>
                        </div> 
                    </div>    
                </div>
    
                <!-- //////////////
                <div class="chart-container">
    
                    <div class="chart-group">
                        <div class="main-chart" id="SomaticDiv0"></div>
                        <div class="main-chart" id="SomaticDiv1"></div>
                        <div class="main-chart" id="SomaticDiv2"></div>
                    </div>
    
                </div>
                <div class="chart-group">
                    <div id = "mystats" class = "dc-data-count" style = "float: left; display: block; font-size: large;">
                        <span class = "filter-count"></span> selected out of <span
                           class = "total-count"></span> | <a href = "javascript:dc.filterAll();uncheckAllTicks();
                           dc.renderAll();">Reset All</a>
                    </div>
                </div>
                
                <div id="mygraph"></div>
                /////////// -->
                
    
                
    
                
                
                
    
                <div id="otherTissueSelect"></div>
    
                <div id="uploadSegments">
                    <!-- <input type="button" value="Upload All Segments for graph" onclick="uploadAllGraph()">
                    <input type="button" value="Upload Filtered for graph" onclick="uploadFilteredGraph()">
                    
                    <input type="button" value="Mark Current Segments" onclick="markSegments()">
                    <input type="button" value="Unmark segments" onclick="unmarkSegments()"> -->
                </div> 
                
    
                
            </div>
                
                
            
        </div> <!--  end mynetwork         -->
        

        
        <script type="text/javascript">

            async function readJSONFromDirectory(filePath) {
                return new Promise(function(resolve, reject) {
                    resolve($.getJSON(filePath, function (data) {
                        console.log("readFromDirectory data", data);
                        return data;
                    }));
                });
            }

            function readFile(file) {
              return new Promise((resolve, reject) => {
                let fr = new FileReader();
                fr.onload = x=> resolve(fr.result);
                fr.readAsText(file);
            })}
            async function read(input) {
                let iii=9
                text = await readFile(input.files[0]);
                var dotList = input.files[0].name.split(".");
                if (input.files[0].type === "application/json" || dotList[dotList.length - 1] === "json") {
                    rez = JSON.parse(text);
                    data = rez;
                    iii = 1;
                    console.log("read data", input.files[0].name)
                    console.log(data);
                    container.setData(data);
                }
                document.getElementById("topSelectInfo").style.visibility = "visible";
            }


            // function start(){
            //     //console.log(bloodCellGO);
            //     $('#mynetwork').show();
            //     $('#graphVisDiv').show();
            //     container.setData(bigData);
            //     container.GOData = bloodCellGO;
            // }


            function chromosomeChanged(){
                newChr = document.getElementById("chrSelect").value
                container.changeChrTo(newChr);
            }

            function hideShowGroup(){ /////////////////////////////////////////////////// 
                let checked = getCheckedByName('checkCluster');
                let checkedInts = _.map(checked, function(v){return parseInt(v) });
                checked = checkedInts.reduce((a, b) => a + b, 0);
                container.showFilteredClusters(checked);
            }

            function selectNext(){
                var sel = document.getElementById('chrSelect');
                var i = sel.selectedIndex;
                sel.options[++i%sel.options.length].selected = true;
                chromosomeChanged();
            }
            function selectPrev(){
                var sel = document.getElementById('chrSelect');
                var i = sel.selectedIndex;
                if (i==0) {
                    i = sel.options.length;
                }
                i=i-1;
                sel.options[i].selected = true;
                chromosomeChanged();
            }

            function toggleView(){
                $("#mynetwork").toggle();
                $("#mygraph").toggle();
                $("#graphButton").toggle();
                $("#crossfilterButton").toggle();
                if( $("#mygraph").is(':visible') ) {
                    callMakeGraph();
                }
            }

            function clearDiv(parent) { 
                while(parent.firstChild) { 
                    parent.removeChild(parent.firstChild); 
                };
            };


            var container = new myContainer("mynetwork");
            function resetAll(){
                container.resetAll();
            }
            function uploadSegments(){
                container.uploadSegments();
                document.getElementById("statsDownload").style.visibility = "visible";
                document.getElementById("downloadCSVBtnDiv").style.visibility = "visible";
                document.getElementById("allCharts").style.visibility = "visible";
            }


            function markSegments(){
                container.markSegments();
            }
            function unmarkSegments(){
                container.unmarkSegments();
            }


            function uploadFilteredGraph(){
                container.uploadFilteredGraph();
            }
            function uploadAllGraph(){
                container.uploadAllGraph();
            }

            function downloadCSV(){
                container.downloadCSV();
            }
            


        </script>
    </body>
</html> 